<script type="text/javascript">
    // This is the main JavaScript code to run your game
    async function runPygame() {
        const loadingMessage = document.getElementById('loading-message');
        
        try {
            // 1. Load the Pyodide engine
            loadingMessage.innerText += "\nLoading Pyodide (Python interpreter)...";
            const pyodide = await loadPyodide();
            
            // 2. Load the 'pygame' package directly (The correct name is just 'pygame')
            loadingMessage.innerText += "\nLoading pygame library directly...";
            await pyodide.loadPackage("pygame"); 
            
            // 3. Fetch your Python game file (space_shooter.py)
            loadingMessage.innerText += "\nFetching space_shooter.py...";
            const response = await fetch('space_shooter.py');
            if (!response.ok) {
                throw new Error(`Failed to fetch space_shooter.py: ${response.statusText}. Did you commit space_shooter.py?`);
            }
            const pythonCode = await response.text();
            
            // 4. Run the game!
            loadingMessage.innerText = "Starting game...";
            
            // This tells Pygame to use the div#pygame-canvas-container
            pyodide.globals.set("PYGAME_CANVAS_ID", "pygame-canvas-container");
            
            await pyodide.runPythonAsync(pythonCode);
            
            // 5. Hide the loading message once the game starts
            loadingMessage.style.display = 'none';

        } catch (err) {
            // If something goes wrong, show the error
            loadingMessage.innerText = `FATAL ERROR:\n${err.message}`;
            console.error(err);
        }
    }
    
    // Start the game
    runPygame();
</script>