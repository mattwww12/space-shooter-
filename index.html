<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pyodide Micropip Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-3xl w-full bg-white shadow-xl rounded-xl p-8 space-y-6">
        <h1 class="text-3xl font-bold text-gray-800 border-b pb-2">Pyodide Environment Loader</h1>
        
        <div id="loading" class="text-center p-4">
            <div class="flex items-center justify-center space-x-2">
                <div class="w-4 h-4 bg-indigo-500 rounded-full animate-pulse"></div>
                <div class="w-4 h-4 bg-indigo-500 rounded-full animate-pulse delay-150"></div>
                <div class="w-4 h-4 bg-indigo-500 rounded-full animate-pulse delay-300"></div>
                <p class="text-indigo-600 font-medium">Initializing Pyodide and loading packages...</p>
            </div>
        </div>

        <div id="output" class="hidden">
            <h2 class="text-xl font-semibold mb-3 text-gray-700">Python Output</h2>
            <pre id="python-output" class="bg-gray-800 text-green-400 p-4 rounded-lg overflow-x-auto text-sm"></pre>
        </div>
        
        <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative">
            <strong class="font-bold">Error:</strong>
            <span class="block sm:inline" id="error-text"></span>
        </div>
    </div>

    <script>
        // Set up constants for elements
        const loadingElement = document.getElementById('loading');
        const outputElement = document.getElementById('output');
        const pythonOutputElement = document.getElementById('python-output');
        const errorElement = document.getElementById('error-message');
        const errorTextElement = document.getElementById('error-text');

        // Main function to run Pyodide
        async function main() {
            try {
                // Initialize Pyodide
                const pyodide = await loadPyodide();
                
                // IMPORTANT FIX: Load the 'micropip' package explicitly in JavaScript
                // This resolves the ModuleNotFoundError before the Python code executes.
                await pyodide.loadPackage('micropip'); 
                
                loadingElement.classList.add('hidden');
                outputElement.classList.remove('hidden');

                // --- Python Code to Run ---
                const pythonCode = `
import micropip
import sys

# Demonstrates successful import and use of micropip
print("✅ Pyodide initialized successfully.")
print("✅ micropip module is loaded and imported.")
print("Installing 'requests' via micropip...")

# We use the blocking version for simplicity in this single-file script
await micropip.install("requests")

print("✅ 'requests' installed successfully.")

# Test the installed package
try:
    import requests
    print("✅ 'requests' can be imported and is ready to use.")
except ImportError:
    print("❌ Failed to import 'requests'.")

print(f"Python version: {sys.version.split(' ')[0]}")
                `;

                // Run the Python code and capture the output
                const result = await pyodide.runPythonAsync(pythonCode);
                
                // Print the result (which is usually the output of print() statements)
                pythonOutputElement.textContent = pyodide.globals.get('stdout');

            } catch (error) {
                loadingElement.classList.add('hidden');
                errorElement.classList.remove('hidden');
                console.error("Pyodide execution failed:", error);
                errorTextElement.textContent = "An error occurred during Pyodide execution. Check the console for details. (Error: " + error.name + ")";
            }
        }

        // We run the main function when the script loads
        main();
    </script>
</body>
</html>